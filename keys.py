# -*- coding: utf-8 -*-

keys = {
    "TRNS": 0,
    "NO": 1,
    "LEFT_CONTROL": 224,
    "LCTRL": 224,
    "LCTL": 224,
    "LEFT_SHIFT": 225,
    "LSHIFT": 225,
    "LSFT": 225,
    "LEFT_ALT": 226,
    "LALT": 226,
    "LEFT_SUPER": 227,
    "LGUI": 227,
    "LCMD": 227,
    "LWIN": 227,
    "RIGHT_CONTROL": 228,
    "RCTRL": 228,
    "RCTL": 228,
    "RIGHT_SHIFT": 229,
    "RSHIFT": 229,
    "RSFT": 229,
    "RIGHT_ALT": 230,
    "RALT": 230,
    "RIGHT_SUPER": 231,
    "RGUI": 231,
    "RCMD": 231,
    "RWIN": 231,
    "A": 4,
    "B": 5,
    "C": 6,
    "D": 7,
    "E": 8,
    "F": 9,
    "G": 10,
    "H": 11,
    "I": 12,
    "J": 13,
    "K": 14,
    "L": 15,
    "M": 16,
    "N": 17,
    "O": 18,
    "P": 19,
    "Q": 20,
    "R": 21,
    "S": 22,
    "T": 23,
    "U": 24,
    "V": 25,
    "W": 26,
    "X": 27,
    "Y": 28,
    "Z": 29,
    "1": 30,
    "N1": 30,
    "2": 31,
    "N2": 31,
    "3": 32,
    "N3": 32,
    "4": 33,
    "N4": 33,
    "5": 34,
    "N5": 34,
    "6": 35,
    "N6": 35,
    "7": 36,
    "N7": 36,
    "8": 37,
    "N8": 37,
    "9": 38,
    "N9": 38,
    "0": 39,
    "N0": 39,
    "ENTER": 40,
    "ENT": 40,
    "\n": 40,
    "ESCAPE": 41,
    "ESC": 41,
    "BACKSPACE": 42,
    "BSPC": 42,
    "TAB": 43,
    "\t": 43,
    "SPACE": 44,
    " ": 44,
    "MINUS": 45,
    "-": 45,
    "EQUAL": 46,
    "=": 46,
    "LBRACKET": 47,
    "LBRC": 47,
    "[": 47,
    "RBRACKET": 48,
    "RBRC": 48,
    "]": 48,
    "BACKSLASH": 49,
    "BSLS": 49,
    "\\": 49,
    "PIPE": 561,  # '|'
    "SEMICOLON": 51,
    "SCLN": 51,
    ";": 51,
    "QUOTE": 52,
    "QUOT": 52,
    "'": 52,
    "GRAVE": 53,
    "`": 53,
    "COMMA": 54,
    ",": 54,
    "DOT": 55,
    ".": 55,
    "SLASH": 56,
    "SLSH": 56,
    "F1": 58,
    "F2": 59,
    "F3": 60,
    "F4": 61,
    "F5": 62,
    "F6": 63,
    "F7": 64,
    "F8": 65,
    "F9": 66,
    "F10": 67,
    "F11": 68,
    "F12": 69,
    "F13": 104,
    "F14": 105,
    "F15": 106,
    "F16": 107,
    "F17": 108,
    "F18": 109,
    "F19": 110,
    "F20": 111,
    "F21": 112,
    "F22": 113,
    "F23": 114,
    "F24": 115,
    "CAPS_LOCK": 57,
    "CAPSLOCK": 57,
    "CAPS": 57,
    "PRINT_SCREEN": 70,
    "PSCREEN": 70,
    "PSCR": 70,
    "SCROLL_LOCK": 71,
    "SCROLLLOCK": 71,
    "SLCK": 71,
    "PAUSE": 72,
    "PAUS": 72,
    "BRK": 72,
    "INSERT": 73,
    "INS": 73,
    "HOME": 74,
    "PGUP": 75,
    "DELETE": 76,
    "DEL": 76,
    "END": 77,
    "PGDOWN": 78,
    "PGDN": 78,
    "RIGHT": 79,
    "RGHT": 79,
    "LEFT": 80,
    "DOWN": 81,
    "UP": 82,
    "NUM_LOCK": 83,
    "NUMLOCK": 83,
    "NLCK": 83,
    "KP_SLASH": 84,
    "NUMPAD_SLASH": 84,
    "PSLS": 84,
    "KP_ASTERISK": 85,
    "NUMPAD_ASTERISK": 85,
    "PAST": 85,
    "KP_MINUS": 86,
    "NUMPAD_MINUS": 86,
    "PMNS": 86,
    "KP_PLUS": 87,
    "NUMPAD_PLUS": 87,
    "PPLS": 87,
    "KP_ENTER": 88,
    "NUMPAD_ENTER": 88,
    "PENT": 88,
    "KP_1": 89,
    "P1": 89,
    "NUMPAD_1": 89,
    "KP_2": 90,
    "P2": 90,
    "NUMPAD_2": 90,
    "KP_3": 91,
    "P3": 91,
    "NUMPAD_3": 91,
    "KP_4": 92,
    "P4": 92,
    "NUMPAD_4": 92,
    "KP_5": 93,
    "P5": 93,
    "NUMPAD_5": 93,
    "KP_6": 94,
    "P6": 94,
    "NUMPAD_6": 94,
    "KP_7": 95,
    "P7": 95,
    "NUMPAD_7": 95,
    "KP_8": 96,
    "P8": 96,
    "NUMPAD_8": 96,
    "KP_9": 97,
    "P9": 97,
    "NUMPAD_9": 97,
    "KP_0": 98,
    "P0": 98,
    "NUMPAD_0": 98,
    "KP_DOT": 99,
    "PDOT": 99,
    "NUMPAD_DOT": 99,
    "KP_EQUAL": 103,
    "PEQL": 103,
    "NUMPAD_EQUAL": 103,
    "KP_COMMA": 133,
    "PCMM": 133,
    "NUMPAD_COMMA": 133,
    "KP_EQUAL_AS400": 134,
    "NUMPAD_EQUAL_AS400": 134,
    "NONUS_HASH": 50,
    "NUHS": 50,
    "NONUS_BSLASH": 100,
    "NUBS": 100,
    "APP": 101,
    "APPLICATION": 101,
    "SEL": 101,
    "WINMENU": 101,
    "PWR": 102,
    "INT1": 135,
    "RO": 135,
    "INT2": 136,
    "KANA": 136,
    "INT3": 137,
    "JYEN": 137,
    "INT4": 138,
    "HENK": 138,
    "INT5": 139,
    "MHEN": 139,
    "INT6": 140,
    "INT7": 141,
    "INT8": 142,
    "INT9": 143,
    "LANG1": 144,
    "HAEN": 144,
    "LANG2": 145,
    "HAEJ": 145,
    "LANG3": 146,
    "LANG4": 147,
    "LANG5": 148,
    "LANG6": 149,
    "LANG7": 150,
    "LANG8": 151,
    "LANG9": 152,
    "ACCENT": 181,
    "ACC": 181,  # '`'
    "TILDE": 693,  # '~'
    "UNDERLINE": 557,
    "UNDS": 557,  # 512 + 45 'MINUS'
    "PLUS": 558,
    "LCBR": 569,  # '{'
    "RCBR": 570,  # '}'
    "AUDIO_MUTE": 17634,
    "MUTE": 17634,  # 0b0100_0100_0000_0000 = 17408
    "AUDIO_VOL_UP": 17641,
    "VOLU": 17641,
    "AUDIO_VOL_DOWN": 17642,
    "VOLD": 17642,
    "MEDIA_NEXT_TRACK": 17589,
    "MNXT": 17589,
    "MEDIA_PREV_TRACK": 17590,
    "MPRV": 17590,
    "MEDIA_STOP": 17591,
    "MSTP": 17591,
    "MEDIA_PLAY_PAUSE": 17613,
    "MPLY": 17613,
    "MEDIA_EJECT": 17592,
    "EJCT": 17592,
    "MEDIA_FAST_FORWARD": 17587,
    "MFFD": 17587,
    "MEDIA_REWIND": 175878,
    "MRWD": 17588,
    "RGB_TOG": 1000,
    "RGB_HUI": 1001,
    "RGB_HUD": 1002,
    "RGB_SAI": 1003,
    "RGB_SAD": 1004,
    "RGB_VAI": 1005,
    "RGB_VAD": 1006,
    "RGB_ANI": 1007,
    "RGB_AND": 1008,
    "RGB_MODE_PLAIN": 1009,
    "RGB_MP": 1009,
    "RGB_MODE_BREATHE": 1010,
    "RGB_MB": 1010,
    "RGB_MODE_RAINBOW": 1011,
    "RGB_MR": 1011,
    "RGB_MODE_BREATHE_RAINBOW": 1012,
    "RGB_MBR": 1012,
    "RGB_MODE_SWIRL": 1013,
    "RGB_MS": 1013,
    "RGB_MODE_KNIGHT": 1014,
    "RGB_MK": 1014,
    "RGB_LIGHT_SHOW": 1015,
    "RGB_LS": 1015,
    "MO": 1016,
    "DF": 1017,
    "LM": 1018,
    "LT": 1019,
    "TG": 1020,
    "TO": 1021,
    "TT": 1022,
    "MT": 1023,
}


class decode:
    def __getattr__(self, _key):
        """Support for accessing dictionary entries in dot notation like `k.KC_ESC` rather than `k['KC_ESC']`"""
        return keys[_key]


KC = decode()

ACT_MODS = 0b0000
ACT_MODS_TAP = 0b0010
ACT_USAGE = 0b0100
ACT_MOUSEKEY = 0b0101
ACT_LAYER = 0b1000
ACT_LAYER_TAP = 0b1010  # Layer  0-15
ACT_LAYER_TAP_EXT = 0b1011  # Layer 16-31
ACT_MACRO = 0b1100
ACT_BACKLIGHT = 0b1101
ACT_COMMAND = 0b1110
ACT_FUNCTION = 0b1111
OP_BIT_AND = 0
OP_BIT_OR = 1
OP_BIT_XOR = 2
OP_BIT_SET = 3
ON_PRESS = 1
ON_RELEASE = 2
ON_BOTH = 3
OP_TAP_TOGGLE = 0xF0


def MODS(*args):
    MAP = {
        KC.LCTRL: 1,
        KC.LSHIFT: 2,
        KC.LALT: 4,
        KC.LGUI: 8,
        KC.RCTRL: 0x10,
        KC.RSHIFT: 0x20,
        KC.RALT: 0x40,
        KC.RGUI: 0x80,
    }
    mods = 0
    for m in args:
        if m not in MAP:
            raise ValueError("Invalid modifier {}".format(m))
        mods |= MAP[m]
    print("mods:{:02x}".format(mods))
    return mods


def get_action_code(kname=""):
    """convert keyname to action code"""
    return [code for code, name in keys.items() if name == kname]


def ACTION(kind, param):
    return (kind << 16) | param


def SK(key, mods):
    return ACTION(
        ACT_MODS, (MODS(mods) << 8) | key
    )  # klawisz z modulatorem np. SHIFT+a


def MT(key, mods):
    return ACTION(0b0010, (MODS(mods) << 8) | key)  # tap klawisz, hold modulator


def MOUSEKEY(key):
    return ACTION(ACT_MOUSEKEY, key)


def LAYER_BITOP(op, part, bits, on):
    return ACTION(ACT_LAYER, op << 10 | on << 8 | part << 5 | (bits & 0x1F))


def LAYER_BIT_XOR(part, bits, on):
    return LAYER_BITOP(OP_BIT_XOR, part, bits, on)


def LAYER_INVERT(layer, on):
    return LAYER_BIT_XOR(layer / 4, 1 << (layer % 4), on)


def LAYER_TOGGLE(layer):
    return LAYER_INVERT(layer, ON_RELEASE)


def MO(layer, key=KC.NO):
    return ACTION(ACT_LAYER_TAP, (layer << 8) | key)


def TT(layer):
    return MO(layer, OP_TAP_TOGGLE)


def LM(layer, mods):
    return MO(layer, 0xC0 | mods)


def ACTION_USAGE_SYSTEM(n):
    return ACTION(ACT_USAGE, n)


def ACTION_USAGE_CONSUMER(n):
    return ACTION(0b0100, 1 << 10 | (n))


def ACTION_MOUSEKEY(key):
    return ACTION(ACT_MOUSEKEY, key)


MS_BTN1 = MOUSEKEY(1 << 0)
MS_BTN2 = MOUSEKEY(1 << 1)
MS_BTN3 = MOUSEKEY(1 << 2)
MS_BTN4 = MOUSEKEY(1 << 3)
MS_BTN5 = MOUSEKEY(1 << 4)
MS_UP = MOUSEKEY(1 << 8)
MS_DN = MOUSEKEY(2 << 8)
MS_LT = MOUSEKEY(3 << 8)
MS_RT = MOUSEKEY(4 << 8)
MS_UL = MOUSEKEY(5 << 8)
MS_UR = MOUSEKEY(6 << 8)
MS_DL = MOUSEKEY(7 << 8)
MS_DR = MOUSEKEY(8 << 8)
MS_W_UP = MOUSEKEY(9 << 8)
MS_W_DN = MOUSEKEY(10 << 8)

MS_MOVEMENT = (
    (0, 0, 0),
    (0, -2, 0),
    (0, 2, 0),
    (-2, 0, 0),
    (2, 0, 0),
    (-1, -1, 0),
    (1, -1, 0),
    (-1, 1, 0),
    (1, 1, 0),
    (0, 0, 1),
    (0, 0, -1),
)


def MACRO(n):
    return ACTION(ACT_MACRO, n)


def BACKLIGHT(n):
    return ACTION(ACT_BACKLIGHT, n)


RGB_TOGGLE = BACKLIGHT(0)
RGB_MOD = BACKLIGHT(1)
MOD_RGB = BACKLIGHT(2)
RGB_HUE = BACKLIGHT(3)
HUE_RGB = BACKLIGHT(4)
RGB_SAT = BACKLIGHT(5)
SAT_RGB = BACKLIGHT(6)
RGB_VAL = BACKLIGHT(7)
VAL_RGB = BACKLIGHT(8)


def COMMAND(opt, n):
    return ACTION(ACT_COMMAND, opt << 8 | n)


BOOTLOADER = COMMAND(0, 0)
HEATMAP = COMMAND(0, 1)
SUSPEND = COMMAND(0, 2)
SHUTDOWN = COMMAND(0, 3)
USB_TOGGLE = COMMAND(0, 4)


def BT(n):
    return COMMAND(1, n)


BT0 = BT(0)
BT1 = BT(1)
BT2 = BT(2)
BT3 = BT(3)
BT4 = BT(4)
BT5 = BT(5)
BT6 = BT(6)
BT7 = BT(7)
BT8 = BT(8)
BT9 = BT(9)
BT_TOGGLE = BT(0xFF)
BT_ON = BT(0xFE)
BT_OFF = BT(0xFD)

# Consumer Page(0x0C)
AUDIO_MUTE = ACTION_USAGE_CONSUMER(0x00E2)
AUDIO_VOL_UP = ACTION_USAGE_CONSUMER(0x00E9)
AUDIO_VOL_DOWN = ACTION_USAGE_CONSUMER(0x00EA)
TRANSPORT_NEXT_TRACK = ACTION_USAGE_CONSUMER(0x00B5)
TRANSPORT_PREV_TRACK = ACTION_USAGE_CONSUMER(0x00B6)
TRANSPORT_STOP = ACTION_USAGE_CONSUMER(0x00B7)
TRANSPORT_STOP_EJECT = ACTION_USAGE_CONSUMER(0x00CC)
TRANSPORT_PLAY_PAUSE = ACTION_USAGE_CONSUMER(0x00CD)
# application launch
APPLAUNCH_CC_CONFIG = ACTION_USAGE_CONSUMER(0x0183)
APPLAUNCH_EMAIL = ACTION_USAGE_CONSUMER(0x018A)
APPLAUNCH_CALCULATOR = ACTION_USAGE_CONSUMER(0x0192)
APPLAUNCH_LOCAL_BROWSER = ACTION_USAGE_CONSUMER(0x0194)
# application control
APPCONTROL_SEARCH = ACTION_USAGE_CONSUMER(0x0221)
APPCONTROL_HOME = ACTION_USAGE_CONSUMER(0x0223)
APPCONTROL_BACK = ACTION_USAGE_CONSUMER(0x0224)
APPCONTROL_FORWARD = ACTION_USAGE_CONSUMER(0x0225)
APPCONTROL_STOP = ACTION_USAGE_CONSUMER(0x0226)
APPCONTROL_REFRESH = ACTION_USAGE_CONSUMER(0x0227)
APPCONTROL_BOOKMARKS = ACTION_USAGE_CONSUMER(0x022A)
# supplement for Bluegiga iWRAP HID(not supported by Windows?)
APPLAUNCH_LOCK = ACTION_USAGE_CONSUMER(0x019E)
TRANSPORT_RECORD = ACTION_USAGE_CONSUMER(0x00B2)
TRANSPORT_FAST_FORWARD = ACTION_USAGE_CONSUMER(0x00B3)
TRANSPORT_REWIND = ACTION_USAGE_CONSUMER(0x00B4)
TRANSPORT_EJECT = ACTION_USAGE_CONSUMER(0x00B8)
APPCONTROL_MINIMIZE = ACTION_USAGE_CONSUMER(0x0206)
# https://docs.microsoft.com/en-us/windows-hardware/drivers/hid/display-brightness-control
DISPLAY_BRIGHTNESS_UP = ACTION_USAGE_CONSUMER(0x006F)
DISPLAY_BRIGHTNESS_DOWN = ACTION_USAGE_CONSUMER(0x0070)
